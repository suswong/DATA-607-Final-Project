---
title: "DATA 607 Final Project"
author: "Susanna Wong"
date: "2023-04-30"
output: 
  html_document:
    theme: cerulean
    code_folding: hide
    toc: true
    toc_float: true
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

The safety of the neighborhood is one of the key factors that people consider when choosing a where to live.The objective of this project is to explore the trends of crime over the period of 2018-2022.

# Data {.tabset}

Crime Data: Use publicly available arrest data from the New York City Open Data.
The data includes information such as the type of crime, the location and date of the arrest, information of perpetrators.
<https://data.cityofnewyork.us/Public-Safety/NYPD-Arrests-Data-Historic-/8h9b-rp9u>

NY Borough Population Size: Webscrap population size of each NY borough from CityPopulation.
The website contains the population of each NY borough according to census results.
<https://www.citypopulation.de/en/usa/newyorkcity/>

## NYC Open Data

There are over 5 million arrest recorded on "NYPD Arrests Data (Historical)" dataset.
It contains every arrest made from 2006 to 2022.
For this project, we will be using every arrest made from 2018 to 2022.
Below is a breakdown of each column of the dataset, which was extracted from the NYC Open Data website.

+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Column Name            | Description                                                                                                                                                          | Data Type        |
+========================+======================================================================================================================================================================+==================+
| ARREST_KEY             | Randomly generated persistent ID for each arrest                                                                                                                     | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| ARREST_DATE            | Exact date of arrest for the reported event                                                                                                                          | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| PD_CD                  | Three digit internal classification code (more granular than Key Code)                                                                                               | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| PD_DESC                | Description of internal classification corresponding with PD code (more granular than Offense Description)                                                           | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| KY_CD                  | Three digit internal classification code (more general category than PD code)                                                                                        | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| OFNS_DESC              | Description of internal classification corresponding with KY code (more general category than PD description)                                                        | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| LAW_CODE               | Law code charges corresponding to the NYS Penal Law, VTL and other various local laws                                                                                | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| LAW_CAT_CD             | Level of offense: felony, misdemeanor, violation                                                                                                                     | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| ARREST_BORO            | Borough of arrest. B(Bronx), S(Staten Island), K(Brooklyn), M(Manhattan), Q(Queens)                                                                                  | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| ARREST_PRECINCT        | Precinct where the arrest occurred                                                                                                                                   | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| JURISDICTION_CODE      | Jurisdiction responsible for arrest. Jurisdiction codes 0(Patrol), 1(Transit) and 2(Housing) represent NYPD whilst codes 3 and more represent non NYPD jurisdictions | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| AGE_GROUP              | Perpetrator's age within a category                                                                                                                                  | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| PERP_SEX               | Perpetrator's sex description                                                                                                                                        | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| PERP_RACE              | Perpetrator's race description                                                                                                                                       | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| X_COORD_CD             | Midblock X-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104)                                                   | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Y_COORD_CD             | Midblock Y-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104)                                                   | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Latitude               | Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326)                                                                              | num              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Longitude              | Longitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326)                                                                             | num              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Lon_Lat                | Georeferenced Point Column based on Longitude and Latitude fields                                                                                                    | chr              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Zip.Codes              | Zip code of arrest                                                                                                                                                   | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Community.Districts    |                                                                                                                                                                      | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Borough.Boundaries     |                                                                                                                                                                      | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| City.Council.Districts |                                                                                                                                                                      | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+
| Police.Precincts       |                                                                                                                                                                      | int              |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------+

```{r}
data_2022 <- read.csv("https://raw.githubusercontent.com/suswong/DATA-607-Final-Project/main/NYPD_Arrests_Data__Historic_-2022.csv", header = T, na.strings = "NA")

data_2021 <- read.csv("https://raw.githubusercontent.com/suswong/DATA-607-Final-Project/main/NYPD_Arrests_Data__Historic_-2021.csv", header = T, na.strings = "NA")

data_2020 <- read.csv("https://raw.githubusercontent.com/suswong/DATA-607-Final-Project/main/NYPD_Arrests_Data__Historic_-2020.csv", header = T, na.strings = "NA")

data_2019 <- read.csv("https://raw.githubusercontent.com/suswong/DATA-607-Final-Project/main/NYPD_Arrests_Data__Historic_-2019.csv", header = T, na.strings = "NA")

data_2018 <- read.csv("https://raw.githubusercontent.com/suswong/DATA-607-Final-Project/main/NYPD_Arrests_Data__Historic_2018.csv", header = T, na.strings = "NA")

data_2018_2022 <- rbind(data_2018,data_2019,data_2020,data_2021,data_2022)
```

## NY Population

```{r}
library(rvest)
web = read_html("https://www.citypopulation.de/en/usa/newyorkcity/")
HTML_df <- html_table(web) 
population <- HTML_df[[1]]

library(DT)
datatable(population)
```

# Tidying Data {.tabset}

## NYC Arrest Data {.tabset}

Below are some of things that needs to be tidied for the analysis:

-   Remove columns that are not needed in the analysis

-   Rename values in the 'ARREST_BORO' column

-   Change format of 'ARREST_DATE' to date format

-   Missing values

### Remove Duplicates

Each crime has a randomly generated persistent ID.
They are recorded in the 'ARREST_KEY' column.
Below is code that removes another duplicates based on the ID.

```{r}
data_2018_2022 <- subset(data_2018_2022, !duplicated(data_2018_2022$ARREST_KEY))
```

### Remove columns

Use `str()` to check the structure of each dataset.

We do not need the following columns in our analysis:

-   ARREST_KEY

-   PD_CD

-   KY_CD

-   LAW_CODE

-   ARREST_PRECINCT

-   JURISDICTION_CODE

-   Community.Districts

-   Borough.Boundaries

-   City.Council.Districts

-   Police.Precincts

```{r}
str(data_2018_2022)
# 
# library(dplyr)
# data_2018_2022 <- data_2018_2022 %>%
#   select(-ARREST_KEY,-KY_CD, -PD_CD, -LAW_CODE, -ARREST_PRECINCT, -JURISDICTION_CODE, -Community.Districts, -Borough.Boundaries, -City.Council.Districts, -Police.Precincts)

```

### Rename Values in 'ARREST_BORO' and 'LAW_CAT_CD'

The 'ARREST_BORO' column contains the borough in which the arrest was made.
The 'LAW_CAT_CD' column contains the level of offense: felony, misdemeanor, violation.
However, those values are in abbreviation.

```{r, message=FALSE}
data_2018_2022$ARREST_BORO[grep("B", data_2018_2022$ARREST_BORO)] <- "Bronx"
data_2018_2022$ARREST_BORO[grep("K", data_2018_2022$ARREST_BORO)] <- "Brooklyn"
data_2018_2022$ARREST_BORO[grep("M", data_2018_2022$ARREST_BORO)] <- "Manhattan"
data_2018_2022$ARREST_BORO[grep("Q", data_2018_2022$ARREST_BORO)] <- "Queens"
data_2018_2022$ARREST_BORO[grep("S", data_2018_2022$ARREST_BORO)] <- "Staten Island"

data_2018_2022$LAW_CAT_CD[grep("F", data_2018_2022$LAW_CAT_CD)] <- "Felony"
data_2018_2022$LAW_CAT_CD[grep("M", data_2018_2022$LAW_CAT_CD)] <- "Misdemeanor"
data_2018_2022$LAW_CAT_CD[grep("V", data_2018_2022$LAW_CAT_CD)] <- "Violation"
```

### Change format of 'ARREST_DATE'

The 'ARREST_DATE' needs to be converted to date format.

```{r, message=FALSE}
library(lubridate)
data_2018_2022$ARREST_DATE <- as.Date(data_2018_2022$ARREST_DATE, format = "%m/%d/%Y" )

data_2018_2022$YEAR <- as.numeric(format(data_2018_2022$ARREST_DATE,'%Y'))
data_2018_2022$month <- as.numeric(format(data_2018_2022$ARREST_DATE,'%m'))
data_2018_2022$DAY <-  wday(data_2018_2022$ARREST_DATE, label=TRUE)
data_2018_2022$MONTH <- months(data_2018_2022$ARREST_DATE, abbreviate=TRUE)
```

### Missing Values

Missing values like location or crime tpye cannot be computed.
So depending on the number of missing values, they will be ommitted.
Use `colSums(is.na())` to check for missing values.
Use `is.na()` or `complete.cases()` to deal with missing values.
There are missing values in the crime description column.
It will need to be manually adjusted.

```{r}
colSums(is.na(data_2018_2022))

data_2018_2022 <- data_2018_2022[complete.cases(data_2018_2022),]

data_2018_2022 <- data_2018_2022 %>%
  dplyr::filter(OFNS_DESC !="") %>%
  dplyr::filter(OFNS_DESC != "(null)")

colSums(is.na(data_2018_2022))

```

### Duplicates

Check for duplicates

```{r}
dplyr::distinct(data_2018_2022)
```

### Group similar crimes

There are 78 crime types.
We can combine some of the crimes into one type as some are similar.
For example there are crime type called "CHILD ABANDONMENT/NON SUPPORT" and "CHILD ABANDONMENT/NON SUPPORT 1".
They could be mislabeled.
Create a new column to group similar crime types.

```{r}
table(data_2018_2022$OFNS_DESC)
length(unique(table(data_2018_2022$OFNS_DESC)))

# Copy 'OFNS_DESC' into a new column called 'crime'
data_2018_2022$crime <- as.character(data_2018_2022$OFNS_DESC)

### Group similar names (Maybe some values are misspelled)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("ADMINISTRATIVE CODE","ADMINISTRATIVE CODES"),"ADMINISTRATIVE CODE", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("CHILD ABANDONMENT/NON SUPPORT","CHILD ABANDONMENT/NON SUPPORT 1"),"CHILD ABANDONMENT", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("CRIMINAL MISCHIEF & RELATED OF","CRIMINAL MISCHIEF & RELATED OFFENSES"),"CRIMINAL MISCHIEF & RELATED OFFENSES", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("DISRUPTION OF A RELIGIOUS SERV","DISRUPTION OF A RELIGIOUS SERVICE"),"DISRUPTION OF A RELIGIOUS SERVICE", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("HARASSMENT","HARRASSMENT 2"),"HARASSMENT", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("INTOXICATED & IMPAIRED DRIVING","INTOXICATED/IMPAIRED DRIVING"),"INTOXICATED & IMPAIRED DRIVING", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("HOMICIDE-NEGLIGENT,UNCLASSIFIE","HOMICIDE-NEGLIGENT,UNCLASSIFIED"),"HOMICIDE-NEGLIGENT,UNCLASSIFIED", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("KIDNAPPING","KIDNAPPING & RELATED OFFENSES", "KIDNAPPING AND RELATED OFFENSES"),"KIDNAPPING", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("MURDER & NON-NEGL. MANSLAUGHTE","MURDER & NON-NEGL. MANSLAUGHTER"),"MURDER & NON-NEGL. MANSLAUGHTER", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("POSSESSION OF STOLEN PROPERTY","POSSESSION OF STOLEN PROPERTY 5"),"POSSESSION OF STOLEN PROPERTY", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("OTHER STATE LAWS (NON PENAL LAW)","OTHER STATE LAWS (NON PENAL LA"),"OTHER STATE LAWS (NON PENAL LAW)", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("UNAUTHORIZED USE OF A VEHICLE","UNAUTHORIZED USE OF A VEHICLE 3 (UUV)"),"UNAUTHORIZED USE OF A VEHICLE", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("LOITERING","LOITERING FOR DRUG PURPOSES","LOITERING/GAMBLING (CARDS, DIC", "LOITERING/GAMBLING (CARDS, DICE, ETC)"),"LOITERING", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("OFFENSES AGAINST PUBLIC ADMINISTRATION","OFFENSES AGAINST PUBLIC ADMINI"),"OFFENSES AGAINST PUBLIC ADMINISTRATION", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("OTHER OFFENSES RELATED TO THEF","OTHER OFFENSES RELATED TO THEFT"),"OTHER OFFENSES RELATED TO THEFT", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("OFF. AGNST PUB ORD SENSBLTY & RGHTS TO PRIV","OFF. AGNST PUB ORD SENSBLTY &"),"OFF. AGNST PUB ORD SENSBLTY & RGHTS TO PRIV", data_2018_2022$crime)

######## Grouping similar crimes

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("ASSAULT 3 & RELATED OFFENSES","FELONY ASSAULT"),"ASSAULT", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("BURGLAR'S TOOLS","BURGLARY"),"BURGLARY", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("FELONY SEX CRIMES","FORCIBLE TOUCHING","PROSTITUTION & RELATED OFFENSES", "SEX CRIMES"),"SEXUAL OFFENSES", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("OTHER OFFENSES RELATED TO THEF","OTHER OFFENSES RELATED TO THEFT","THEFT OF SERVICES", "POSSESSION OF STOLEN PROPERTY"),"THEFT", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("GRAND LARCENY", "GRAND LARCENY OF MOTOR VEHICLE"),"GRAND LARCENY", data_2018_2022$crime)


data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("FRAUDS","FRAUDULENT ACCOSTING","OFFENSES INVOLVING FRAUD", "FORGERY"),"FRAUD", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("CANNABIS RELATED OFFENSES","DANGEROUS DRUGS"),"DRUG", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("OTHER STATE LAWS","OTHER STATE LAWS (NON PENAL LAW)"),"OTHER STATE LAWS", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("HOMICIDE-NEGLIGENT-VEHICLE","HOMICIDE-NEGLIGENT,UNCLASSIFIED"),"HOMICIDE-NEGLIGENT", data_2018_2022$crime)

data_2018_2022$crime <- ifelse(data_2018_2022$crime %in% c("VEHICLE AND TRAFFIC LAWS","UNAUTHORIZED USE OF A VEHICLE", "OTHER TRAFFIC INFRACTION", "INTOXICATED & IMPAIRED DRIVING", "MOVING INFRACTIONS", "PARKING OFFENSES"),"VEHICLE AND TRAFFIC LAWS", data_2018_2022$crime)

table(data_2018_2022$crime)
length(unique(table(data_2018_2022$crime)))
```

## NY Population by Borough {.tabset}

To calculate the crime rate by borough, we need the population of each borough.
We will only need the population census in 2020.

Below are some of things that needs to be tidied for the analysis:

-   Remove columns that are not needed in the analysis

-   Rename column labels

-   Change format of the population column to numeric

### Remove columns

Removes the other years' population size except for 2020

```{r}
population_boro <- population[, -c(2:5,7:8)] #Removes the other years' population size except for 2020

population_boro <- as.data.frame(population_boro)
datatable(population_boro)
```

### Rename Column and Values

```{r}
colnames(population_boro) <- c("Borough", "Population_Census_2020")
population_boro$Borough[grep("Bronx", population_boro$Borough)] <- "Bronx"
population_boro$Borough[grep("Brooklyn", population_boro$Borough)] <- "Brooklyn"
population_boro$Borough[grep("Staten Island", population_boro$Borough)] <- "Staten Island"
population_boro$Borough[grep("Manhattan", population_boro$Borough)] <- "Manhattan"

str(population_boro)

population_boro$Population_Census_2020 <- as.numeric(gsub(",","",population_boro$Population_Census_2020))
```

# Map Visualization {.tabset}

## Interactive Map Visusalization

Here we have an interactive map of all arrests made in New York from 2018-2022.
Viewers can view the distribution of the arrests in the five boroughs.

```{r, message=FALSE}
library(dplyr)
library(leaflet)
library(RColorBrewer)
arrests<-rename(data_2022,lat=Latitude,lng=Longitude, radius = 5)
info<-paste("<b>Offense: </b>",arrests$PD_DESC,"<br>",
            "<b>Perpetrator Gender: </b>",arrests$PERP_SEX,"<br>",
            "<b>Perpetrator Age: </b>",arrests$AGE_GROUP,"<br>",
            "<b>Perpetrator Race: </b>",arrests$PERP_RACE,sep = "")

pal<-colorFactor(c("blue","darkgreen","red"),arrests$LAW_CAT_CD)

arrests_map <- arrests %>%
  leaflet()%>%
  addTiles()%>%
    addCircleMarkers(clusterOptions=markerClusterOptions(),
               popup=info,color=pal(arrests$LAW_CAT_CD)) 
# %>%
#     addLegend(labels=c("Free - Unlimited","Free - Limited","Partner"),colors=c("blue","darkgreen","red"))
arrests_map
```

## Density Map

```{r}
library(ggmap)
api <- rstudioapi::askForPassword("Database password")
register_google(key= api)

crime <- data_2018_2022

nyc_map <- ggmap(get_map(location =  c(min(crime$Longitude),
                               min(crime$Latitude),
                               max(crime$Longitude),
                               max(crime$Latitude)), zoom = 11, scale = 2, maptype = "terrain", color = 'color'))


nyc_map + stat_density2d(aes(x = Longitude, y = Latitude, fill = ..level..), alpha = .1, bins = 50, data = crime, geom = "polygon")+
  scale_fill_viridis_c(option = "plasma") +
facet_wrap(~ YEAR)

```

### Arrest in 2022

```{r}
library(ggmap)

crime <- data_2022

nyc_map <- ggmap(get_map(location = "New York City", zoom = 11, scale = 2, maptype = "terrain", color = 'color'))


nyc_map + stat_density2d(aes(x = Longitude, y = Latitude, fill = ..level..), alpha = .1, bins = 50, data = crime, geom = "polygon")+
  scale_fill_viridis_c(option = "plasma")

```

# Levels of Offense

Majority of the arrests are misdemeanor.
More than 50% are misdemeanor.

```{r, message=FALSE}
library(kableExtra)
Leveloffense <- data_2018_2022 %>%
  filter(LAW_CAT_CD  %in% c("Misdemeanor","Felony", "Violation")) %>%
  group_by(LAW_CAT_CD) %>%
  summarise(count = n()) %>%
  mutate(percentage = count/sum(count)) %>%
  arrange(desc(percentage))

Leveloffense$percentage <- scales::percent(Leveloffense$percentage, accuracy = 1) 

Leveloffense%>%
  kable(digits = 1, format.args = list(big.mark = ","),
             col.names = c("Level", "Total Arrest","Percentage"),
             caption="Total arrests by level of offense from 2018-2022.") %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped")
```

# Demographic of Perpetraitor in Each Borough

## Gender

In each borough, about 80% of the perpetrator is male and about 20% are female.

```{r, message=FALSE}
library(ggplot2)
gender <- data_2018_2022 %>%
  group_by(PERP_SEX, ARREST_BORO)%>%
  summarise(count = n())

gender <- gender %>%
  group_by(ARREST_BORO) %>%
  mutate(percentage = (count/sum(count)))

ggplot(gender, aes (x = factor(percentage), y = percentage, fill = PERP_SEX))+
    geom_bar(stat="identity", na.rm = TRUE)+
    facet_wrap(~ARREST_BORO, ncol =3, scales = "free_x", drop = TRUE) +
    theme(
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
    )

```

## Age Group

The most common perpetrators are in the age range 25-44 years old and male.

```{r, message=FALSE}
Agegroup <- data_2018_2022 %>%
   dplyr::group_by(AGE_GROUP, PERP_SEX)%>%
  dplyr::summarise(count = n()) %>%
  mutate(percentage = count/sum(count))

ggplot(Agegroup, aes(AGE_GROUP, count)) +   
  geom_bar(aes(fill = PERP_SEX), position = "dodge", stat="identity")
  
```

## Race by Borough

```{r, message=FALSE}
race_by_borough <- data_2018_2022 %>%
  dplyr::group_by(PERP_RACE, ARREST_BORO)%>%
  dplyr::summarise(count = n())

race_by_borough <- race_by_borough %>%
  dplyr::group_by(ARREST_BORO) %>%
  dplyr::mutate(percentage = (count/sum(count)))%>%
  dplyr::mutate(labels = scales::percent(percentage ))


ggplot(race_by_borough, aes (x = factor(percentage), y = percentage, fill = PERP_RACE))+
    geom_bar(stat="identity", na.rm = TRUE)+
    facet_wrap(~ARREST_BORO, ncol =3, scales = "free_x", drop = TRUE) +
    theme(
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank() 
    )

# ggplot(data=race_by_borough, aes(x=" ", y=percentage, group=PERP_RACE, colour=PERP_RACE, fill=PERP_RACE)) +
#          geom_bar(width = 1, stat = "identity") +
#          coord_polar("y", start=0) + 
#    geom_text(aes(label = labels),
#             position = position_stack(vjust = 0.5)) +
#          facet_grid(.~ ARREST_BORO) +theme_void()

```

# Trends

## Daily Crimes in New York from 2018 -- 2022

Overall, there is a decrease in the number of crimes from 2018 to mid 2020 and a increase in the number of crimes from mid 2020 to end of 2022.

```{r, message=FALSE}
crime_daily <- data_2018_2022 %>%
  group_by(ARREST_DATE) %>%
  summarize(count = n()) %>%
  arrange(ARREST_DATE)

library(ggplot2)
library(scales)
ggplot(crime_daily, aes(x = ARREST_DATE, y = count)) +
  geom_line(color = "#F2CA27", size = 0.1) +
  geom_smooth(color = "#1A1A1A") +
  # fte_theme() +
  scale_x_date(breaks = date_breaks("1 year"), labels = date_format("%Y")) +
  labs(x = "Date of Crime", y = "Number of Crimes", title = "Daily Crimes in New York from 2018 â€“ 2022")

```

## Trends in Crime of During the Week Per Year

Based on the graph, there seems to be more crimes in the middle of the week for each year.
In each year, the number of arrests peaks on Wednesday.

```{r, message=FALSE}
library(gganimate)
library(gifski)

days_trend <- data_2018_2022 %>%
  group_by(DAY,YEAR) %>%
  summarise(count = n())

p <- days_trend %>%
  group_by(YEAR) %>%
    ggplot(., aes(x = DAY, y = count, fill = DAY)) + 
    geom_bar(stat = "identity", show.legend = FALSE) +
    labs(title = "Year: {closest_state}") +
    xlab("Day of week") +
    ylab("Number of crimes")

a <- p +
    transition_states(YEAR, wrap = FALSE)
animate(a, nframes = 5, fps = 0.5)

```

## Trends in Crime for Months of Each Year

Year 2020 crime trends differs the most compared to the other years.
It may be related to the COVID outbreak in 2020 which led to a NY lockdown in March.
In 2020, there was a decrease in the number of arrest from January to April, and a sharp increase in May.
By October 2022, the number of crimes return back to pre covid (prior 2020) levels.

```{r, message=FALSE, warning=FALSE}
month_trend <- data_2018_2022 %>%
  dplyr::group_by(month,YEAR) %>%
  dplyr::summarise(count = n()) 

p <- month_trend %>%
  group_by(YEAR) %>%
    ggplot(., aes(x = reorder(month, month), y = count, fill = month)) + 
    geom_bar(stat = "identity", show.legend = FALSE) +
    labs(title = "Year: {closest_state}") +
    xlab("Month") +
    ylab("Number of crimes")

a <- p +
    transition_states(YEAR, wrap = FALSE)
animate(a, nframes = 5, fps = 0.5)

# month_trend <- data_2018_2022 %>%
#   dplyr::group_by(month,YEAR) %>%
#   dplyr::summarise(count = n()) 
# 
# month_trend$YEAR <- as.character(month_trend$YEAR)
# 
# ggplot(month_trend, aes(x = month, y = count, colour = YEAR)) +
#   geom_line() + scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) + ggtitle("Total Arrests Per Year")
```

# Top 10 Offenses in NY {.tabset}

## Datatable

Out of all the offenses, assault is the highest, followed by petit larceny, drugs, and vehicle and traffic laws.

```{r, message=FALSE}
library(DT)
library(dplyr)
offense <- data_2018_2022 %>%
  dplyr::group_by(crime) %>%
  dplyr::summarise(total = n()) 

offense2 <- data_2018_2022 %>%
  dplyr::group_by(crime, ARREST_BORO) %>%
  dplyr::summarise(count = n()) 
  
library(tidyr)
offense2 <- offense2 %>%
  pivot_wider(names_from = ARREST_BORO, values_from = count)

offense3 <- merge(x=offense2,y=offense, 
             by="crime", all.x=TRUE)

datatable(offense3)
```

## Visualization {.tabset}

Out of all the offenses, assault is the highest, followed by petit larceny, drugs, and vehicle and traffic laws.

```{r, message=FALSE}
library(ggplot2)

offense %>% 
    arrange(desc(total)) %>%
    slice(1:15) %>%
    ggplot(., aes(x=reorder(crime, total), y=total))+
              geom_bar(stat='identity', fill="lightblue") + coord_flip() + xlab("Offense")+ ylab("Count") +  
  ggtitle("Top 10 Offense in NY")
```

## Changes in Crime By Year

From the graph, arrests related to assaults continues to be the highest crime from 2018 to 2022.
The number of arrests for each crime decreases from 2018 to 2022.
Arrests related to drugs was the second highest in 2018.
However, arrests related to petit larceny is the second highest in 2022.
There are more fraud related cases in 2022 than in 2018.

```{r, message=FALSE}
crime <- data_2018_2022 %>%
  dplyr::group_by(YEAR, ARREST_BORO, crime) %>%
  dplyr::summarise(count = n()) 

# Create a new column for the population size for each borough
crime$population <- 
  with(crime, ifelse(ARREST_BORO == "Brooklyn", population_boro[2,2],
                         ifelse(ARREST_BORO == "Bronx", population_boro[1,2],
                        ifelse(ARREST_BORO == "Queens", population_boro[4,2],
                         ifelse(ARREST_BORO == "Manhattan", population_boro[3,2],population_boro[5,2]      )))))

# Rename column names
colnames(crime) <- c("Year" ,"Borough", "crime","count", "population")

# Calculate the crime rate per year and borough
crime <- crime %>%
  mutate(crime_rate = (count/population)*10000)

h <- crime %>%
  filter(crime %in% c("ASSAULT","PETIT LARCENY","DRUG","FELONY ASSAULT","MISCELLANEOUS PENAL LAW" ,"VEHICLE AND TRAFFIC LAWS", "CRIMINAL MISCHIEF & RELATED OFFENSES" ,"ROBBERY","GRAND LARCENY" , "DANGEROUS WEAPONS","FRAUD"))%>%
  group_by(Year, crime) %>%
  summarise(crime_rate = sum(crime_rate))

ggplot(h, aes(x = Year, y = crime_rate, colour = crime)) +
  geom_line() + scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) + ggtitle("Changes in Crime By Year")
```

## Daily Trend for Top 10 Crimes

Early we noted that the total number arrest peak on Wednesday for each year from 2018 to 2022.
However, on analyzing the daily trends of the top ten crimes, not all crimes peak on Wednesday.

+--------------------------------------+--------------------------------------------------------------------------+
| Crime                                | Daily Trend                                                              |
+======================================+==========================================================================+
| ASSAULT                              | **Highest Count Daily**                                                  |
|                                      |                                                                          |
|                                      | Increase from Sunday to Wednesday and decrease after (Peak on Wednesday) |
+--------------------------------------+--------------------------------------------------------------------------+
| PETIT LARCENY                        | Increase from Sunday to Wednesday and decrease after (Peak on Wednesday) |
+--------------------------------------+--------------------------------------------------------------------------+
| **DRUG**                             | **Higher counts from Wednesday to Saturday**                             |
+--------------------------------------+--------------------------------------------------------------------------+
| MISCELLANEOUS PENAL LAW              | Increase from Sunday to Wednesday and decrease after (Peak on Wednesday) |
+--------------------------------------+--------------------------------------------------------------------------+
| **VEHICLE AND TRAFFIC LAWS**         | **Looks almost constant throughout the week**                            |
+--------------------------------------+--------------------------------------------------------------------------+
| CRIMINAL MISCHIEF & RELATED OFFENSES | Increase from Sunday to Wednesday and decrease after (Peak on Wednesday) |
+--------------------------------------+--------------------------------------------------------------------------+
| ROBBERY                              | Increase from Sunday to Wednesday and decrease after (Peak on Wednesday) |
+--------------------------------------+--------------------------------------------------------------------------+
| GRAND LARCENY                        | Increase from Sunday to Wednesday and decrease after (Peak on Wednesday) |
+--------------------------------------+--------------------------------------------------------------------------+
| **DANGEROUS WEAPONS**                | **Higher counts from Wednesday to Saturday**                             |
+--------------------------------------+--------------------------------------------------------------------------+
| FRAUD                                | Increase from Sunday to Wednesday and decrease after                     |
+--------------------------------------+--------------------------------------------------------------------------+

```{r, message=FALSE}
library(gganimate)
library(gifski)

crime_trend <- data_2018_2022 %>%
  filter(crime %in% c("ASSAULT","PETIT LARCENY","DRUG","FELONY ASSAULT","MISCELLANEOUS PENAL LAW" ,"VEHICLE AND TRAFFIC LAWS", "CRIMINAL MISCHIEF & RELATED OFFENSES" ,"ROBBERY","GRAND LARCENY" , "DANGEROUS WEAPONS","FRAUD")) %>%
  group_by(crime,DAY) %>%
  summarise(count = n())

p <- crime_trend %>%
  group_by(crime) %>%
    ggplot(., aes(x = DAY, y = count, fill = DAY)) + 
    geom_bar(stat = "identity", show.legend = FALSE) +
    labs(title = "Crime: {closest_state}") +
    xlab("Day of week") +
    ylab("Number of crimes")

a <- p +
    transition_states(crime, wrap = FALSE)
animate(a, nframes = 10, fps = 0.5)

```

## Number of Arrests for Top 10 Crimes Daily Per Year

From the animation, we can see assault related arrests remains the highest from 2018 to 2022.
Besides assault, petit larcenry stood out the most from 2020 - 2022.

```{r, message=FALSE}
qw <- data_2018_2022 %>%
  filter(crime %in% c("ASSAULT","PETIT LARCENY","DRUG","FELONY ASSAULT","MISCELLANEOUS PENAL LAW" ,"VEHICLE AND TRAFFIC LAWS", "CRIMINAL MISCHIEF & RELATED OFFENSES" ,"ROBBERY","GRAND LARCENY" , "DANGEROUS WEAPONS","FRAUD"))

temp <- qw %>%
  dplyr::group_by(crime, DAY, YEAR)%>%
  dplyr::summarise(count = n())

temp2 <- temp %>%
  ggplot(., aes(x= crime, y= DAY, fill= count)) + 
  geom_tile(aes(fill= count)) +
scale_x_discrete("Crime", expand = c(0,0)) + 
  scale_y_discrete("Day of week", expand = c(0,-2)) + 
  scale_fill_gradient("Number of crimes", low = "white", high = "steelblue") +
theme_bw() + ggtitle("Year: {closest_state}") +
theme(panel.grid.major = element_line(colour = NA), panel.grid.minor = element_line(colour = NA)) + theme(axis.text.x=element_text(angle=45,hjust=1)) 

  
a <- temp2 +
    transition_states(YEAR, wrap = FALSE)
animate(a, nframes = 5, fps = 0.5)
```

```{r}

```

# Crime Rate by Borough and Year {.tabset}

Calculate the crime rate for each borough by dividing the number of arrests in each borough by its population.
This will allow us to compare crime rates on an equal basis across different boroughs.

## Datatable

Below is a table of the crime rate per 100000 people for each borough and year.
In all years except 2019, Queens has the lowest crime rate per 100000 people.
Bronx has the highest crime per 10000 people for all years except in 2021.

```{r, message=FALSE}
# Count the number of arrests in each borough by year
borough_by_year <- data_2018_2022 %>%
  dplyr::group_by(YEAR, ARREST_BORO) %>%
  dplyr::summarise(count = n()) 

# Create a new column for the population size for each borough
borough_by_year$population <- 
  with(borough_by_year, ifelse(ARREST_BORO == "Brooklyn", population_boro[2,2],
                         ifelse(ARREST_BORO == "Bronx", population_boro[1,2],
                        ifelse(ARREST_BORO == "Queens", population_boro[4,2],
                         ifelse(ARREST_BORO == "Manhattan", population_boro[3,2],population_boro[5,2]      )))))

# Rename column names
colnames(borough_by_year) <- c("Year" ,"Borough", "count", "population")

# Calculate the crime rate per year and borough
borough_by_year <- borough_by_year %>%
  mutate(crime_rate = (count/population)*10000)

datatable(borough_by_year,options = list(pageLength = 5, dom = 'tip'))
```

## Visualization

In all years except 2019, Queens has the lowest crime rate per 10000 people.
Bronx has the highest crime per 10000 people for all years except in 2021.

All of the boroughs follow a similar trend of a decrease of crime rate from 2018 to 2020 and an overall increase after.

```{r, message=FALSE, warning=FALSE}
ggplot(borough_by_year, aes(x = Year, y = crime_rate, colour = Borough)) +
  geom_smooth() + scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) + ggtitle("Crime Rate Per 10000 People")
```

## Top Offense Per Borough {.tabset}

Below is an animation of top offense for each borough, based on the percentage of arrest crime type in each borough.
Assault related arrest remains to be the highest in all borough.

```{r, message=FALSE}
crime_by_borough <- data_2018_2022 %>%
  group_by(OFNS_DESC,ARREST_BORO) %>%
  summarise(count = n()) 

crime_by_borough$population <- 
  with(crime_by_borough, ifelse(ARREST_BORO == "Brooklyn", population_boro[2,2],
                         ifelse(ARREST_BORO == "Bronx", population_boro[1,2],
                        ifelse(ARREST_BORO == "Queens", population_boro[4,2],
                         ifelse(ARREST_BORO == "Manhattan", population_boro[3,2],population_boro[5,2]      )))))

crime_by_borough <- crime_by_borough %>%
  group_by(ARREST_BORO) %>%
  mutate(offense_rate = (count/sum(count)))

# crime_by_borough <- crime_by_borough %>%
#   filter(crime_rate > 5000)
  
```

```{r, message=FALSE}
#install.packages("gganimate")
#install.packages("gifski")

library(gganimate)
library(gifski)

p <- crime_by_borough %>%
  arrange(desc(offense_rate)) %>%
  group_by(ARREST_BORO) %>%
  slice(1:10) %>%
    ggplot(., aes(x = reorder(OFNS_DESC, offense_rate),
                                                 y = offense_rate,
                                                 fill = ARREST_BORO)) + 
    geom_bar(stat = "identity", show.legend = FALSE) +
    labs(title = "") +
    coord_flip()  + 
    xlab("Offense") +
    ylab("Offense Rate") +
  ggtitle("Borough: {closest_state}")

a <- p +
    transition_states(ARREST_BORO, wrap = FALSE)
animate(a, nframes = 5, fps = 0.5)
```

### Trends of Top 10 Crimes in Manhattan

For all boroughs, the highest arrest is related to assault.
However, compared to the boroughs, the number of petit larcerny arrests sotod out the most in Manhattan.

```{r, warning=FALSE, message=FALSE}
temp100 <- qw %>%
  group_by(ARREST_DATE, ARREST_BORO, crime)%>%
  summarise(total = n())

temp100  %>%
  filter(ARREST_BORO=="Manhattan") %>%
  ggplot(aes(ARREST_DATE, total, colour = crime)) +
  geom_smooth() + 
  ggtitle("Trends of Top 10 Crimes in Manhattan")
```

### Trends of Top 10 Crimes in Brooklyn

```{r, warning=FALSE, message=FALSE}
temp100  %>%
  filter(ARREST_BORO=="Brooklyn") %>%
  ggplot(aes(ARREST_DATE, total, colour = crime)) +
  geom_smooth() + 
  ggtitle("Trends of Top 10 Crimes in Brooklyn")
```

### Trends of Top 10 Crimes in Bronx

```{r, warning=FALSE, message=FALSE}

temp100  %>%
  filter(ARREST_BORO=="Bronx") %>%
  ggplot(aes(ARREST_DATE, total, colour = crime)) +
  geom_smooth()+ 
  ggtitle("Trends of Top 10 Crimes in Bronx")

```

### Trends of Top 10 Crimes in Staten Island

By 2022, the next highest number of arrests is related to Vehicle and traffic laws.
This crime type stood out the most in Staten Island compared to other boroughs.

```{r, warning=FALSE, message=FALSE}
temp100  %>%
  filter(ARREST_BORO=="Staten Island") %>%
  ggplot(aes(ARREST_DATE, total, colour = crime)) +
  geom_smooth() + 
  ggtitle("Trends of Top 10 Crimes in Staten Island")
```

### Trends of Top 10 Crimes in Queens

```{r, warning=FALSE, message=FALSE}
temp100  %>%
  filter(ARREST_BORO=="Queens") %>%
  ggplot(aes(ARREST_DATE, total, colour = crime)) +
  geom_smooth()+ 
  ggtitle("Trends of Top 10 Crimes in Queens")
```

# Changes in Crime Rate from 2018 - 2022 {.tabset}

Compare the normalized crime rate of 2018 and 2022.
Compare the normalized crime rate of 2021 and 2022.
There is still a decrease in crime rate in all borough.
Brooklyn has the highest percentage decrease of crime rate.
However, it was noted that there was a trend of decrease in the number of arrests from 2018 to mid 2020 and a increase in the number of arrests from mid 2020 to end of 2022.
So comparing the crime rate in 2021 and 2022, all borough shows an increase of crime rate.
Bronx has the highest percentage of increase in crime rate and Staten Island has the lowest percentage of increase in crime rate.

```{r}
arrests_2018 <- borough_by_year %>%
  filter(Year == 2018)
arrests_2021 <- borough_by_year %>%
  filter(Year == 2021)
arrests_2022 <- borough_by_year %>%
  filter(Year == 2022)

arrests_combined2018_2022 <- merge(arrests_2018, arrests_2022, by = c("Borough"), all = TRUE)

arrests_combined2018_2022 <- arrests_combined2018_2022[,-2]
arrests_combined2018_2022 <- arrests_combined2018_2022[,-2]
arrests_combined2018_2022 <- arrests_combined2018_2022[,-2]
arrests_combined2018_2022 <- arrests_combined2018_2022[,-3]
arrests_combined2018_2022 <- arrests_combined2018_2022[,-3]
arrests_combined2018_2022 <- arrests_combined2018_2022[,-3]
arrests_combined2018_2022$Arrests_2021 <- arrests_2021$crime_rate

names(arrests_combined2018_2022) <- c("BORO","Arrests 2018", "Arrests 2022", "Arrests 2021")

arrests_combined2018_2022$`% Change from 2018 to 2022` <- (arrests_combined2018_2022$`Arrests 2022` - arrests_combined2018_2022$`Arrests 2018`) / arrests_combined2018_2022$`Arrests 2018` * 100

arrests_combined2018_2022$`% Change from 2021 to 2022` <- (arrests_combined2018_2022$`Arrests 2022` - arrests_combined2018_2022$`Arrests 2021`) / arrests_combined2018_2022$`Arrests 2021` * 100

datatable(arrests_combined2018_2022)
```

# ANOVA

Are there any significant differences between the crime rates of each borough?

Null hypothesis: the means of the 5 borough crime rates are the same

Alternative hypothesis: At least one borough crime rates mean is not equal to the others.

## Calculate the summary statistics by Borough

```{r}
levels(as.factor(borough_by_year$Borough))

group_by(borough_by_year, Borough) %>%
  summarise(
    count = n(),
    mean = mean(crime_rate, na.rm = TRUE),
    sd = sd(crime_rate, na.rm = TRUE)
  )
```

## One-Way ANOVA Test

We want to see if the average crime rate of the boroughs vary significantly.
We can conclude that there are significant differences between the boroughs in the model summary because the p-value is less than the significance level.

```{r}
res.aov <- aov(crime_rate ~ Borough, data = borough_by_year)

summary(res.aov)
```

## Pairwise comparisons

### Multiple Tukey pairwise comparisons

We want to check which pair of borough average crime rates is significantly different.
The R function `TukeyHSD()` will compute numerous pairwise comparisons between the boroughs.

Below is the output of Tukey's multiple comparisons of means test with a 95% family-wise confidence level.
The table shows the differences in crime rates between pairs of boroughs, along with the lower and upper bounds of the confidence interval and the p-values adjusted for multiple comparisons.

For example, the first row "Brooklyn-Bronx" indicates that the crime rate in Brooklyn is significantly lower than in the Bronx, with a difference of -103.297229 (per some unit) and a p-value of 0.0309524.

Based on the adjusted p-value (last column),the difference between Queens and Bronx, and the difference between Staten Island and Bronx are significant.

```{r}
TukeyHSD(res.aov)
```

## Check Validy of ANOVA assumption

### Variance homogeneity

Points 1, 3, and 13 are outliers.
There is no evidence of relationship between the residuals and borough mean crime rates.

```{r}
plot(res.aov, 1)
```

We can also use Levene's test to check if the variance across borough crime rates is statistically significant.
The p-value 0.3621 is not less than the significance value.
We can infer the assumption of variance homogeneity is met.

```{r, message=FALSE, warning=FALSE}
library(car)
leveneTest(crime_rate ~ Borough, data = borough_by_year)

```

### Normality

All of the points lies roughly on the line.
The assumption of normality is met.

```{r}
plot(res.aov, 2)
```

We can also use Shapiro-Wilk normality test.

The test statistic, W, is a value between 0 and 1.
A value close to 1 suggests that the data is close to being normally distributed.
The calculated value of W is 0.97532, indicating that the residuals are reasonably close to a normal distribution.

The p-value is a measure of evidence against the null hypothesis of normality.
A p-value (0.7797) larger than the significance level.
Therefore, there is no strong evidence to suggest that the residuals deviate significantly from a normal distribution.

The assumption of normality is met.

```{r}
aov_residuals <- residuals(object = res.aov )
shapiro.test(x = aov_residuals )
```

# Conclusion

**Trends**

Overall, there is a decrease in the number of arrests from 2018 to mid 2020 and a increase in the number of arrests from mid 2020 to end of 2022.

There seems to be more arrests in the middle of the week for each year.
In each year, the total number of arrests peaks on Wednesday, which can mean there are higher activity of crimes during the middle of the week.
However, on analyzing the daily trends of the top ten crimes, not all crimes peak on Wednesday.
Among the top 10 crimes, the number of arrest related to petit larceny, criminal mischief, robbery, grand larceny, and fraud peak on Wednesday.
The number of arrest related to drug and dangerous drug has higher counts from Wednesday to Saturday.
The number of arrest related to vehicle and traffic laws is almost constant throughout the week with higher counts on the weekend.

The top 3 highest crime type based on the number of arrests are: assault, petit larceny, and drug.

**Crime Rate**

The crime rate for each borough is calculated by dividing the number of arrests in each borough by its population.
This will allow us to compare crime rates on an equal basis across different boroughs.

Although Staten Island has the lowest number of arrest, Queens has the lowest crime rate per 100000 people.
Bronx has the highest crime per 10000 people for all years except in 2021.

Comparing the crime rate in 2018 and 2022, there is still a decrease in crime rate in all borough.

Brooklyn has the highest percentage decrease of crime rate.
However, it was noted that there was a trend of decrease in the number of arrests from 2018 to mid 2020 and a increase in the number of arrests from mid 2020 to end of 2022.
So comparing the crime rate in 2021 and 2022, all borough shows an increase of crime rate.
Bronx has the highest percentage of increase in crime rate and Staten Island has the lowest percentage of increase in crime rate.

**Which borough is the safest based on the crime rate?**

Based on these observation, Staten Island and Queens are the safest boroughs.

**Limitations**

There is only data of New York States Census for every 10 years.
The last recorded data was 2020.
To normalized the crime rate, population data was used to calculate the crime rate.
If the population size was available for each year, a more accurate crime rate can be calculated.

It is also important to note the number of arrests may not reflect the number of crimes in NY completely.
Most often, crimes are unreported, crimes are made as complaints but no arrest made, and more.

# Challenges

**Mapping**

My original intention was to plot the density of crime by zip codes to show which zip codes has the lowest and highest crime rate.
I have tried to use shapefiles to create a choropleth map.
However, my attempts were not successful.

During the process of creating the maps, the code I was running caused R to not respond.
I did save the r markdown.
However, it was saved locally on my laptop.
So when I restarted R and reopen the markdown file, it caused R to not respond again.
I had to restart the project and all codes due to the markdown file was inaccessible.
This happened twice.
Luckily for the second time, I saved the markdown file to github so I can re-access any previous work made.

**Time Series Analysis/Forecast**

I was able to start this analysis.
However, due to time constraint and the challenges mentioned earlier, I have not learned how to validate the code/model I have.

# Further Enhancement/ Other Analysis 
1. While crime rates are essential indicators, other factors contribute to the overall safety of a borough. Factors such as access to healthcare, quality of schools, presence of community programs, and socioeconomic factors can also influence the overall safety and well-being of an area. Use regression analysis to examine the relationship between the number of arrests and other variables, such as demographic characteristics of the neighborhoods, unemployment rate, and etc.

2. Perform geospatial analysis to map crime hotspots within each borough using latitude and longitude coordinates or zip codes. This will provide a spatial understanding of crime distribution and potentially highlight areas with higher or lower crime rates.

3. Time Series Analysis: Predict the level of crime in different neighborhoods based on historical data and other variables. This can help identify which neighborhoods are likely to have higher or lower levels of crime in the future.

# Source

1.  Mapping <https://crimebythenumbers.com/choropleth-maps.html> <https://walker-data.com/census-r/mapping-census-data-with-r.html> <https://justinmorganwilliams.medium.com/basics-of-gis-mapping-with-r-using-grow-nyc-markets-75adcdd9b0> <https://cengel.github.io/R-spatial/mapping.html> <https://rpubs.com/schwarja209/NYC_hotspots> <https://journal.r-project.org/archive/2013-1/kahle-wickham.pdf>

2.  ANOVA <https://www.r-bloggers.com/2022/05/one-way-anova-example-in-r-quick-guide/>
